#==============================================================================
# ¡ö Game_Temp
#==============================================================================

class Game_Temp
  
  #--------------------------------------------------------------------------
  # alias method: initialize
  #--------------------------------------------------------------------------
  alias beh_initialize initialize
  def initialize
    beh_initialize
    @tbs_troop = []
  end
  
  #--------------------------------------------------------------------------
  # new method: add_enemy
  #--------------------------------------------------------------------------
  def add_enemy(id, x, y)
    @tbs_troop.push([id, x, y])
  end
  
  #--------------------------------------------------------------------------
  # new method: reset_enemy
  #--------------------------------------------------------------------------
  def reset_enemy
    @tbs_troop.clear
  end
  
  #--------------------------------------------------------------------------
  # new method: tbs_troop
  #--------------------------------------------------------------------------
  def tbs_troop
    @tbs_troop
  end
  
  #--------------------------------------------------------------------------
  # new method: prepare_map
  #--------------------------------------------------------------------------
  def prepare_map
    @backup_map = $game_map
    $game_map = Game_BattleMap.new
  end
  
  #--------------------------------------------------------------------------
  # new method: restore_map
  #--------------------------------------------------------------------------
  def restore_map
    $game_map = @backup_map
    @backup_map = nil
  end
  
end # Game_Temp

#==============================================================================
# ¡ö Game_Unit
#==============================================================================

class Game_Unit
  
  #--------------------------------------------------------------------------
  # * Public Instance Variables
  #--------------------------------------------------------------------------
  attr_reader   :in_tbs
  
  #--------------------------------------------------------------------------
  # alias method: initialize
  #--------------------------------------------------------------------------
  alias beh_initialize initialize
  def initialize
    beh_initialize
    @in_tbs = false
  end
  
  #--------------------------------------------------------------------------
  # new method: on_tbs_start
  #--------------------------------------------------------------------------
  def on_tbs_start
    on_battle_start
    @in_tbs = true
  end
  
  #--------------------------------------------------------------------------
  # new method: on_tbs_end
  #--------------------------------------------------------------------------
  def on_tbs_end
    on_battle_end
    @in_tbs = false
  end
  
end # Game_Unit

#==============================================================================
# ¡ö Game_Party
#==============================================================================

class Game_Party < Game_Unit
  
  #--------------------------------------------------------------------------
  # alias method: battle_members
  #--------------------------------------------------------------------------
  alias beh_battle_members battle_members
  def battle_members
    @in_tbs ? tbs_battle_members : beh_battle_members
  end
  
  #--------------------------------------------------------------------------
  # new method: tbs_battle_members
  #--------------------------------------------------------------------------
  def tbs_battle_members
    $game_map.actor_party ? $game_map.actor_party.compact : []
  end
  
  #--------------------------------------------------------------------------
  # new method: max_tbs_members
  #--------------------------------------------------------------------------
  def max_tbs_members
    HARMONY::ENGINE::DEFAULT_BATTLE_MEMBERS
  end
  
end # Game_Party

#==============================================================================
# ¡ö Game_Troop
#==============================================================================

class Game_Troop < Game_Unit
  
  #--------------------------------------------------------------------------
  # new method: setup_tbs
  #--------------------------------------------------------------------------
  def setup_tbs(enemies)
    enemies.each { |member| @enemies.push(member) }
    make_unique_names
  end
  
end # Game_Troop